#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <time.h>

int main(int argc, char *argv[]){
	if (argc > 1){
		printf("Trop d'arguments !\n");
	}

	int fd[2];
	int nb;
	srand(time(NULL));

	pipe(fd);

	if(fork() == 0){ //Papa créer Fils 1, Ecrivain
		close(fd[0]);

		nb = rand() % 100;

		printf("Numéro choisi : %d\n", nb);

		char cnb[2];

		sprintf(cnb,"%d",nb);

		printf("Je suis le FILS 1 et je vais écrire %s\n",cnb);

		write(fd[1],&cnb,sizeof(int));
		close(fd[1]);

		printf("Fin FILS 1\n");
		exit(EXIT_SUCCESS);
	}
	else{ // Papa va créer un deuxième fils
		if(fork()==0){ // Papa créer FILS 2, Lecteur
			close(fd[1]);

			char cnb[2];

			read(fd[0],cnb,2*sizeof(char));

			printf("Je suis le FILS 2 et je lis %s\n", cnb);

			close(fd[0]);

			printf("Fin FILS 2\n");
			exit(EXIT_SUCCESS);
		}
	}

	wait(NULL);
	wait(NULL);
	printf("FIN PAPA\n");
	exit(0);
}