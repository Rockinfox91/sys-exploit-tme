#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <sys/wait.h>

void setFichier(char* nom, int nb){
	int fichier = open(nom,O_CREAT|O_WRONLY,S_IWUSR);

	char buf = nb +'0';

	write(fichier, &buf, sizeof(char));

	close(fichier);
}

int main(int argc, char* argv[]){
	if(argc < 4){
		printf("Pas assez d'arguments (baigneur, cabine, panier)\n");
		return 0;
	}

	setFichier("cabines.txt",atoi(argv[2]));
	setFichier("paniers.txt",atoi(argv[3]));

	printf("----- DÃ©but du programme -----\n");


	char argument[2] = "0";

	for(int i = 0 ; i< atoi(argv[1]) - 1 ; i++){
		if(fork()==0){
			sprintf(argument,"%d",i+1);
			printf("Nouveau fils : %s\n", argument);
			break;
		}
	}

	printf("Fils %s execute le programme\n", argument);
	execl("Exo3a","Exo3a",argument,NULL);

	return 1;
}